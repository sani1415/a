<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ - ‡¶Æ‡¶æ‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡¶æ‡¶§‡ßÅ‡¶≤ ‡¶Æ‡¶æ‡¶¶‡¶ø‡¶®‡¶æ‡¶π</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    .filter-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px auto;
      max-width: 95%;
    }
    .search-box {
      display: flex;
      gap: 10px;
    }
    .search-box input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 250px;
    }
    .filter-bar button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 15px;
      cursor: pointer;
    }
    .deletion-reason {
      font-style: italic;
      color: #666;
      font-size: 13px;
    }
    .action-btn {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
      margin: 2px;
    }
    .restore-btn {
      background-color: #28a745;
    }
    .view-btn {
      background-color: #17a2b8;
    }
    .empty-list {
      text-align: center;
      padding: 30px;
      color: #666;
      font-style: italic;
    }
    .deleted-date {
      font-size: 13px;
      color: #666;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 0;
      border-radius: 8px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .modal-header {
      padding: 15px 20px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h2 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }
    .close-modal {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: #aaa;
    }
    .close-modal:hover {
      color: #333;
    }
    .modal-body {
      padding: 20px;
    }
    .applicant-name {
      font-weight: bold;
      font-size: 18px;
      margin: 15px 0;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
      text-align: center;
    }
    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    .cancel-btn {
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 15px;
      cursor: pointer;
    }
    .restore-confirm-btn {
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 15px;
      cursor: pointer;
    }
    .nav-tabs {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
      border-bottom: 1px solid #ddd;
    }
    .nav-tabs li {
      padding: 10px 20px;
      cursor: pointer;
    }
    .nav-tabs li.active {
      border-bottom: 3px solid #28a745;
      font-weight: bold;
    }
    <style>
      /* Tab Styling */
      .tab-container {
        width: 100%;
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-bottom: 15px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        font-weight: normal;
      }

      .tab.active {
        font-weight: bold;
        border-bottom: 2px solid #28a745;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Message Styling */
      .messages-container {
        height: 350px;
        overflow-y: auto;
        border: 1px solid #eee;
        border-radius: 4px;
        padding: 15px;
        background-color: #f9f9f9;
        margin-bottom: 15px;
      }

      .admin-message, .applicant-message {
        max-width: 70%;
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 15px;
        position: relative;
      }

      .admin-message {
        background-color: #e8f5e9;
        align-self: flex-start;
        border-bottom-left-radius: 5px;
        margin-right: auto;
      }

      .applicant-message {
        background-color: #dcf8c6;
        align-self: flex-end;
        border-bottom-right-radius: 5px;
        margin-left: auto;
      }

      .time {
        font-size: 11px;
        color: #888;
        margin-top: 5px;
        text-align: right;
      }

      .loading-messages {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .no-messages {
        text-align: center;
        padding: 20px;
        color: #666;
        font-style: italic;
      }

      .message-count {
        text-align: right;
        font-size: 12px;
        color: #666;
        margin-bottom: 15px;
      }

      .archive-info {
        background-color: #f0f0f0;
        padding: 10px 15px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-size: 14px;
      }

      .message-btn {
        background-color: #6c757d;
      }

      .text-center {
        text-align: center;
      }
    </style>
  </style>
</head>
<body>
  <div class="header">
    <h1>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h1>
  </div>

  <div class="nav-tabs">
    <li><a href="{{ url_for('admin') }}" style="text-decoration: none; color: inherit;">‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</a></li>
    <li><a href="{{ url_for('admin_messaging') }}" style="text-decoration: none; color: inherit;">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶Ü‡¶¶‡¶æ‡¶®-‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</a></li>
    <li class="active">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ</li>
  </div>

  <div class="filter-bar">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®...">
      <button onclick="searchDeletedStudents()">üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</button>
    </div>
  </div>

  <table id="deletedTable">
    <thead>
      <tr>
        <th>‡¶®‡¶æ‡¶Æ</th>
        <th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</th>
        <th>‡¶Ö‡¶≠‡¶ø‡¶≠‡¶æ‡¶¨‡¶ï</th>
        <th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th>
        <th>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
        <th>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£</th>
        <th>‡¶è‡¶ï‡¶∂‡¶®</th>
      </tr>
    </thead>
    <tbody id="deletedTableBody">
      <!-- Deleted applicants will be populated here -->
    </tbody>
  </table>

  <!-- Message Archive Modal -->
  <div id="messageArchiveModal" class="modal">
    <div class="modal-content" style="width: 600px; max-height: 80vh;">
      <div class="modal-header">
        <h2>‡¶Ü‡¶∞‡ßç‡¶ï‡¶æ‡¶á‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶≤‡¶æ‡¶™ - <span id="messageArchiveStudentName"></span></h2>
        <span class="close-modal" onclick="closeMessageArchiveModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="archive-info">
          <div>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <span id="messageArchiveDeleteDate"></span></div>
          <div>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶õ‡¶ø‡¶≤: <span id="messageArchiveStatus"></span></div>
        </div>

        <div class="messages-container" id="modalArchivedMessages">
          <!-- Archived messages will be loaded here -->
        </div>

        <div class="message-count" id="messageCount"></div>

        <div class="button-group text-center">
          <button onclick="closeMessageArchiveModal()" class="cancel-btn">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add tabs to the viewDetailsModal -->
<div class="modal-body" id="viewDetailsContent">
  <div class="tab-container">
    <div class="tabs">
      <div class="tab active" onclick="switchTab(this, 'details-content')">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</div>
      <div class="tab" onclick="switchTab(this, 'messages-content')">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶≤‡¶æ‡¶™ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</div>
    </div>

    



    
    
    <div id="details-content" class="tab-content active">
      <!-- Existing details content will be here -->
    </div>
    
    <div id="messages-content" class="tab-content">
      <div class="messages-container" id="archivedMessages">
        <!-- Archived messages will be loaded here -->
        <div class="loading-messages">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
      </div>
    </div>
  </div>
</div>

  <!-- Restore Confirmation Modal -->
  <div id="restoreModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <span class="close-modal" onclick="closeRestoreModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶ï‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?</p>
        <p class="applicant-name" id="restoreApplicantName"></p>
        
        <div class="button-group">
          <button onclick="closeRestoreModal()" class="cancel-btn">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button onclick="confirmRestore()" class="restore-confirm-btn">‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let deletedStudents = [];
    let currentRestoreId = null;
    let currentViewId = null;

    // Fetch deleted applicants
    function fetchDeletedApplicants() {
      fetch('/deleted-data')
        .then(res => res.json())
        .then(data => {
          deletedStudents = data;
          displayDeletedStudents(data);
        })
        .catch(err => {
          document.getElementById('deletedTableBody').innerHTML = `
            <tr>
              <td colspan="7" class="empty-list">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</td>
            </tr>
          `;
        });
    }


  function switchTab(tabElement, contentId) {
  // Remove active class from all tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  // Add active class to selected tab
  tabElement.classList.add('active');
  
  // Show selected content
  document.getElementById(contentId).classList.add('active');
  
  // If messages tab is selected, load messages
  if (contentId === 'messages-content' && currentViewId) {
    loadArchivedMessages(currentViewId, 'archivedMessages');
  }
}

    function loadArchivedMessages(studentId, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '<div class="loading-messages">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';

      fetch(`/get-archived-messages/${studentId}`)
        .then(res => res.json())
        .then(data => {
          if (!data.messages || data.messages.length === 0) {
            container.innerHTML = '<div class="no-messages">‡¶ï‡ßã‡¶® ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
            return;
          }

          let messagesHtml = '';
          data.messages.forEach(message => {
            const messageClass = message.sent_by === 'admin' ? 'admin-message' : 'applicant-message';

            messagesHtml += `
              <div class="${messageClass}">
                ${message.text}
                <div class="time">${message.timestamp}</div>
              </div>
            `;
          });

          container.innerHTML = messagesHtml;

          // Update message count if we're in the modal view
          if (containerId === 'modalArchivedMessages') {
            document.getElementById('messageCount').textContent = `‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ: ${data.messages.length}`;
          }

          // Scroll to bottom
          container.scrollTop = container.scrollHeight;
        })
        .catch(error => {
          container.innerHTML = '<div class="no-messages">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</div>';
        });
    }

    function viewArchivedMessages(studentId) {
      const student = deletedStudents.find(s => s.id === studentId);

      if (!student) return;

      document.getElementById('messageArchiveStudentName').textContent = student.name;
      document.getElementById('messageArchiveDeleteDate').textContent = student.deleted_at;
      document.getElementById('messageArchiveStatus').textContent = student.status;

      // Show the modal
      document.getElementById('messageArchiveModal').style.display = 'block';

      // Load messages
      loadArchivedMessages(studentId, 'modalArchivedMessages');
    }

    function closeMessageArchiveModal() {
      document.getElementById('messageArchiveModal').style.display = 'none';
    }
    

    // Display deleted students in table
    function displayDeletedStudents(students) {
      const tbody = document.getElementById('deletedTableBody');
      
      if (students.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="empty-list">‡¶ï‡ßã‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = '';
      students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.class}</td>
          <td>${student.guardian}</td>
          <td>${student.phone}</td>
          <td class="deleted-date">${student.deleted_at}</td>
          <td class="deletion-reason">${formatReason(student.delete_reason)}</td>
          <td>
  <button class="action-btn view-btn" onclick="viewDetails('${student.id}')">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</button>
  <button class="action-btn restore-btn" onclick="showRestoreConfirmation('${student.id}')">‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞</button>
  ${student.has_messages ? `<button class="action-btn message-btn" onclick="viewArchivedMessages('${student.id}')">üí¨ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶≤‡¶æ‡¶™</button>` : ''}
</td>
        `;
        tbody.appendChild(row);
      });
    }

    // Format reason text
    function formatReason(reason) {
      if (!reason) return "‡¶ï‡ßã‡¶® ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø";
      
      const reasonMap = {
        'duplicate': '‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®',
        'incomplete': '‡¶Ö‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø',
        'requested': '‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®'
      };
      
      return reasonMap[reason] || reason;
    }

    // Search deleted students
    function searchDeletedStudents() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filteredStudents = deletedStudents.filter(student =>
        student.name.toLowerCase().includes(searchTerm) ||
        student.phone.toLowerCase().includes(searchTerm)
      );
      displayDeletedStudents(filteredStudents);
    }

    // View applicant details
    function viewDetails(id) {
  currentViewId = id;
  const student = deletedStudents.find(s => s.id === id);
  
  if (!student) return;
  
  const content = document.getElementById('details-content');
  content.innerHTML = `
    <div style="text-align: center; margin-bottom: 15px;">
      ${student.photo ? `<img src="/static/uploads/${student.photo}" alt="‡¶õ‡¶¨‡¶ø" style="width:100px;height:100px;border-radius:50%;margin-bottom:10px;">` : ''}
      <h3 style="margin: 5px 0;">${student.name}</h3>
      <div style="color: #666; font-size: 14px;">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${student.deleted_at}</div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
      <div style="padding: 10px; background: #f9f9f9;">
        <strong>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${student.birth}
      </div>
      <div style="padding: 10px; background: #f9f9f9;">
        <strong>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø:</strong> ${student.class}
      </div>
      <div style="padding: 10px; background: #f9f9f9;">
        <strong>‡¶Ö‡¶≠‡¶ø‡¶≠‡¶æ‡¶¨‡¶ï:</strong> ${student.guardian}
      </div>
      <div style="padding: 10px; background: #f9f9f9;">
        <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</strong> ${student.phone}
      </div>
      <div style="padding: 10px; background: #f9f9f9; grid-column: span 2;">
        <strong>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</strong> ${student.address}
      </div>
      <div style="padding: 10px; background: #f9f9f9; grid-column: span 2;">
        <strong>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${student.submitted_at}
      </div>
      <div style="padding: 10px; background: #f9f9f9; grid-column: span 2;">
        <strong>‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£:</strong> ${formatReason(student.delete_reason)}
      </div>
    </div>
    
    <div style="margin-top: 20px; text-align: center;">
      <button onclick="showRestoreConfirmation('${student.id}')" class="restore-confirm-btn" style="background-color: #28a745;">‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  `;
  
  // Reset to the details tab
  document.querySelector('.tab').click();
  
  // Show the modal
  document.getElementById('viewDetailsModal').style.display = 'block';
}

    // Close view modal
    function closeViewModal() {
      document.getElementById('viewDetailsModal').style.display = 'none';
    }

    // Show restore confirmation
    function showRestoreConfirmation(id) {
      currentRestoreId = id;
      const student = deletedStudents.find(s => s.id === id);
      
      if (!student) return;
      
      document.getElementById('restoreApplicantName').textContent = student.name;
      document.getElementById('restoreModal').style.display = 'block';
      
      // Close view modal if open
      closeViewModal();
    }

    // Close restore modal
    function closeRestoreModal() {
      document.getElementById('restoreModal').style.display = 'none';
    }

    // Confirm restore
    function confirmRestore() {
      if (!currentRestoreId) return;
      
      fetch(`/restore-applicant/${currentRestoreId}`, {
        method: 'POST'
      })
      .then(res => res.json())
      .then(response => {
        if (response.success) {
          // Remove from local array
          deletedStudents = deletedStudents.filter(s => s.id !== currentRestoreId);
          displayDeletedStudents(deletedStudents);
          closeRestoreModal();
          
          // Show success notification
          alert('‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
        }
      });
    }

    // Initialize
    fetchDeletedApplicants();

    // Listen for Enter key in search input
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchDeletedStudents();
      }
    });

    // Close modals when clicking outside
    window.onclick = function(event) {
      const viewModal = document.getElementById('viewDetailsModal');
      const restoreModal = document.getElementById('restoreModal');
      
      if (event.target === viewModal) {
        closeViewModal();
      } else if (event.target === restoreModal) {
        closeRestoreModal();
      }
    };
  </script>
</body>
</html>